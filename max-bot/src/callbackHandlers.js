import { MainKeyboards } from './mainKeyboards.js';
import { BOT_CONFIG } from './config.js';
import { NewsService } from './services/newsService.js';

export class CallbackHandlers {
  static async startChat(ctx) {
    await ctx.reply('üí¨ *–ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ —á–∞—Ç...*\n\n–ó–∞–¥–∞–≤–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –∏—â–∏—Ç–µ –Ω–æ–≤–æ—Å—Ç–∏! –Ø –≥–æ—Ç–æ–≤ –ø–æ–º–æ—á—å.', {
      format: 'markdown',
      attachments: [MainKeyboards.getChatKeyboard()]
    });
  }

  static async showInfo(ctx) {
    const infoText = `‚ÑπÔ∏è *–û InfoPulse Bot*

*–í–µ—Ä—Å–∏—è:* 2.0.0
*–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫:* InfoPulse Team
*–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞:* MAX Messenger

*–ú–æ–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:*
‚Ä¢ ü§ñ AI-–ø–æ–∏—Å–∫ –Ω–æ–≤–æ—Å—Ç–µ–π
‚Ä¢ üîç –î–æ—Å—Ç—É–ø –∫ 70,000+ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º
‚Ä¢ üì∞ –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
‚Ä¢ üí¨ –£–º–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã

*–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:*
‚Ä¢ NewsAPI –¥–ª—è –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –Ω–æ–≤–æ—Å—Ç–µ–π
‚Ä¢ AI-–∞–ª–≥–æ—Ä–∏—Ç–º—ã –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
‚Ä¢ MAX Bot API –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

üí° *–ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏—Ç–µ —Ç–µ–º—É, –∏ —è –Ω–∞–π–¥—É —Å–≤–µ–∂–∏–µ –Ω–æ–≤–æ—Å—Ç–∏!*`;

    await ctx.reply(infoText, {
      format: 'markdown',
      attachments: [MainKeyboards.getMainMenu()]
    });
  }

  static async showSettings(ctx) {
    await ctx.reply('‚öôÔ∏è *–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞*\n\n–í—ã–±–µ—Ä–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:', {
      attachments: [MainKeyboards.getSettingsKeyboard()]
    });
  }

  static async showAdmin(ctx) {
  console.log('üõ†Ô∏è [SHOW_ADMIN] –ü–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:', {
    userId: ctx.user?.user_id,
    effectiveUserId: ctx.effectiveUserId,
    isAdmin: ctx.isAdmin,
    update: ctx.update
  });

  if (!ctx.isAdmin) {
    const debugInfo = `‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏.

*–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:*
‚Ä¢ –í–∞—à ID: ${ctx.user?.user_id}
‚Ä¢ Effective ID: ${ctx.effectiveUserId}
‚Ä¢ –ê–¥–º–∏–Ω—ã –≤ config: ${BOT_CONFIG.ADMIN_IDS.join(', ')}
‚Ä¢ –¢–∏–ø —Å–æ–±—ã—Ç–∏—è: ${ctx.update?.type}

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. –ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å ID –≤ .env —Ñ–∞–π–ª–µ
2. –ß—Ç–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏–ª–∏ –±–æ—Ç–∞ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
3. –ß—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ —Ç–æ—Ç –∂–µ –∞–∫–∫–∞—É–Ω—Ç`;

    await ctx.reply(debugInfo, { format: 'markdown' });
    return;
  }

  const adminText = `üõ†Ô∏è *–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å InfoPulse*

*–í–∞—à ID:* ${ctx.effectiveUserId}
*–°—Ç–∞—Ç—É—Å:* ‚úÖ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä

–î–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à–µ–Ω! –í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª:`;

  await ctx.reply(adminText, {
    format: 'markdown',
    attachments: [MainKeyboards.getAdminKeyboard()]
  });
}

  static async searchNews(ctx) {
    await ctx.reply('üîç *–ü–æ–∏—Å–∫ –Ω–æ–≤–æ—Å—Ç–µ–π*\n\n–í–≤–µ–¥–∏—Ç–µ —Ç–µ–º—É –¥–ª—è –ø–æ–∏—Å–∫–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä:\n‚Ä¢ "–∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç"\n‚Ä¢ "—á–µ–º–ø–∏–æ–Ω–∞—Ç –º–∏—Ä–∞"\n‚Ä¢ "—ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ –Ω–æ–≤–æ—Å—Ç–∏"\n‚Ä¢ "—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Å—Ç–∞—Ä—Ç–∞–ø—ã"', {
      format: 'markdown'
    });
  }

  static async showTrends(ctx) {
    await ctx.reply('üìä *–¢—Ä–µ–Ω–¥–æ–≤—ã–µ —Ç–µ–º—ã*\n\n–ê–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ç–µ–º—ã —Å–µ–π—á–∞—Å:\n‚Ä¢ ü§ñ –ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç\n‚Ä¢ üåç –ö–ª–∏–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è\n‚Ä¢ üí∞ –≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ –Ω–æ–≤–æ—Å—Ç–∏\n‚Ä¢ ‚öΩ –°–ø–æ—Ä—Ç–∏–≤–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è\n‚Ä¢ üèõÔ∏è –ü–æ–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–±—ã—Ç–∏—è\n\nüí° *–ù–∞–ø–∏—à–∏—Ç–µ –ª—é–±—É—é –∏–∑ —ç—Ç–∏—Ö —Ç–µ–º –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞!*', {
      format: 'markdown'
    });
  }

  static async searchNews(ctx) {
  await ctx.reply('üîç *–ü–æ–∏—Å–∫ –Ω–æ–≤–æ—Å—Ç–µ–π*\n\n–í–≤–µ–¥–∏—Ç–µ —Ç–µ–º—É –¥–ª—è –ø–æ–∏—Å–∫–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä:\n‚Ä¢ "–∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç"\n‚Ä¢ "—á–µ–º–ø–∏–æ–Ω–∞—Ç –º–∏—Ä–∞"\n‚Ä¢ "—ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ –Ω–æ–≤–æ—Å—Ç–∏"\n‚Ä¢ "—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Å—Ç–∞—Ä—Ç–∞–ø—ã"\n\nüí° *–°–æ–≤–µ—Ç:* –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è –ª—É—á—à–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤!', {
    format: 'markdown'
  });
}

static async showTrends(ctx) {
  try {
    await ctx.reply('üìä *–ò—â—É trending –Ω–æ–≤–æ—Å—Ç–∏...*');
    
    const trendingArticles = await NewsService.getTrendingNews();
    
    if (trendingArticles.length > 0) {
      const trendingText = `üìä *–¢—Ä–µ–Ω–¥–æ–≤—ã–µ –Ω–æ–≤–æ—Å—Ç–∏ —Å–µ–π—á–∞—Å*\n\n` +
        trendingArticles.map((article, index) => 
          NewsService.formatArticle(article, index)
        ).join('\n\n' + '‚îÄ'.repeat(30) + '\n\n') +
        `\n\nüí° *–ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Å—Å—ã–ª–∫–∏ —á—Ç–æ–±—ã —á–∏—Ç–∞—Ç—å –ø–æ–ª–Ω—ã–µ —Å—Ç–∞—Ç—å–∏!*`;
      
      await ctx.reply(trendingText, { 
        format: 'markdown',
        attachments: [MainKeyboards.getChatKeyboard()]
      });
    } else {
      await ctx.reply('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å trending –Ω–æ–≤–æ—Å—Ç–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–∏—Å–∫ –≤—Ä—É—á–Ω—É—é!', {
        attachments: [MainKeyboards.getChatKeyboard()]
      });
    }
    
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∫–∞–∑–µ —Ç—Ä–µ–Ω–¥–æ–≤:', error);
    await ctx.reply('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å trending –Ω–æ–≤–æ—Å—Ç–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–∏—Å–∫!', {
      attachments: [MainKeyboards.getChatKeyboard()]
    });
  }
}

static async showExamples(ctx) {
  const examplesText = `üí° *–ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –ø–æ–∏—Å–∫–∞ –Ω–æ–≤–æ—Å—Ç–µ–π:*

*–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:*
"–∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç"
"–Ω–æ–≤—ã–µ –≥–∞–¥–∂–µ—Ç—ã"
"–∫–∏–±–µ—Ä–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å"
"—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –∏–Ω–Ω–æ–≤–∞—Ü–∏–∏"

*–°–ø–æ—Ä—Ç:*
"—Ñ—É—Ç–±–æ–ª—å–Ω—ã–µ –º–∞—Ç—á–∏"
"–æ–ª–∏–º–ø–∏–π—Å–∫–∏–µ –∏–≥—Ä—ã" 
"—Å–ø–æ—Ä—Ç–∏–≤–Ω—ã–µ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä—ã"
"—á–µ–º–ø–∏–æ–Ω–∞—Ç –º–∏—Ä–∞"

*–ü–æ–ª–∏—Ç–∏–∫–∞:*
"–≤—ã–±–æ—Ä—ã 2024"
"–º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è"
"–ø–æ–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ—Ñ–æ—Ä–º—ã"
"–ø—Ä–∞–≤–∏—Ç–µ–ª—å—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è"

*–≠–∫–æ–Ω–æ–º–∏–∫–∞:*
"—Ñ–æ–Ω–¥–æ–≤—ã–π —Ä—ã–Ω–æ–∫"
"–∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã"
"—ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ –Ω–æ–≤–æ—Å—Ç–∏"
"–±–∏–∑–Ω–µ—Å –∏ —Ñ–∏–Ω–∞–Ω—Å—ã"

*–ù–∞—É–∫–∞:*
"–∫–æ—Å–º–∏—á–µ—Å–∫–∏–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è"
"–º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –æ—Ç–∫—Ä—ã—Ç–∏—è"
"–∫–ª–∏–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è"
"–Ω–∞—É—á–Ω—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è"

üéØ *–ü—Ä–æ—Å—Ç–æ –≤–≤–µ–¥–∏—Ç–µ –ª—é–±–æ–π –∑–∞–ø—Ä–æ—Å - –∏ —è –Ω–∞–π–¥—É —Å–≤–µ–∂–∏–µ –Ω–æ–≤–æ—Å—Ç–∏!*`;

  await ctx.reply(examplesText, { format: 'markdown' });
}

  static async showExamples(ctx) {
    const examplesText = `üí° *–ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è —á–∞—Ç–∞:*

*–ü–æ–∏—Å–∫ –Ω–æ–≤–æ—Å—Ç–µ–π:*
"–Ω–æ–≤–æ—Å—Ç–∏ –æ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è—Ö"
"—á—Ç–æ –Ω–æ–≤–æ–≥–æ –≤ –Ω–∞—É–∫–µ" 
"—Å–ø–æ—Ä—Ç–∏–≤–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è —Å–µ–≥–æ–¥–Ω—è"
"–ø–æ–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –Ω–æ–≤–æ—Å—Ç–∏ –Ω–µ–¥–µ–ª–∏"

*–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã:*
"–∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç 2024"
"—ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ –Ω–æ–≤–æ—Å—Ç–∏ –†–æ—Å—Å–∏–∏"
"–≤—ã–±–æ—Ä—ã –≤ –º–∏—Ä–µ"
"—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –∏–Ω–Ω–æ–≤–∞—Ü–∏–∏"

*–û–±—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã:*
"—á—Ç–æ —Ç—ã —É–º–µ–µ—à—å?"
"—Ä–∞—Å—Å–∫–∞–∂–∏ –æ —Å–µ–±–µ"
"–∫–∞–∫–∏–µ –Ω–æ–≤–æ—Å—Ç–∏ —Å–∞–º—ã–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ?"
"–ø–æ–º–æ–≥–∏ –Ω–∞–π—Ç–∏ –Ω–æ–≤–æ—Å—Ç–∏ –æ..."

üéØ *–ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏—Ç–µ —Ç–µ–º—É - –∏ —è –Ω–∞–π–¥—É –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏!*`;

    await ctx.reply(examplesText, { format: 'markdown' });
  }

  static async backToMain(ctx) {
    await ctx.reply('üîÑ *–í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é...*', {
      format: 'markdown',
      attachments: [MainKeyboards.getMainMenu()]
    });
  }

  static async toggleNotifications(ctx) {
    await ctx.reply('üîî –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã –≤ —Å–ª–µ–¥—É—é—â–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏!');
  }

  static async changeTheme(ctx) {
    await ctx.reply('üåô –°–º–µ–Ω–∞ —Ç–µ–º—ã –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏!');
  }

  static async showStats(ctx) {
    await ctx.reply('üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.');
  }

  static async adminStats(ctx) {
    if (!ctx.isAdmin) {
      await ctx.reply('‚ùå –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω.');
      return;
    }
    await ctx.reply('üìä –§—É–Ω–∫—Ü–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏.');
  }

  static async adminBroadcast(ctx) {
    if (!ctx.isAdmin) {
      await ctx.reply('‚ùå –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω.');
      return;
    }
    await ctx.reply('üì¢ –§—É–Ω–∫—Ü–∏—è —Ä–∞—Å—Å—ã–ª–∫–∏ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.');
  }

  static async adminManage(ctx) {
    if (!ctx.isAdmin) {
      await ctx.reply('‚ùå –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω.');
      return;
    }
    await ctx.reply('üîß –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏.');
  }
}